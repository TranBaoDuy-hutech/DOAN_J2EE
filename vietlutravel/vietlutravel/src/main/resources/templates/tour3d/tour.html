<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Virtual Tour An Giang ‚Äî Kh√°m Ph√° Mi·ªÅn T√¢y</title>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pannellum/build/pannellum.css"/>
    <script src="https://cdn.jsdelivr.net/npm/pannellum/build/pannellum.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,600;0,700;1,300;1,400&family=Rajdhani:wght@300;400;500;600;700&family=Space+Mono:ital,wght@0,400;0,700&display=swap" rel="stylesheet">

    <style>
        :root {
            --gold: #c9a84c;
            --gold-light: #f0d080;
            --gold-glow: rgba(201,168,76,0.25);
            --deep: #04070e;
            --dark1: #080c18;
            --dark2: #0e1525;
            --dark3: #141e33;
            --glass: rgba(255,255,255,0.04);
            --glass-border: rgba(255,255,255,0.07);
            --text: #f0e8d8;
            --text-dim: rgba(240,232,216,0.55);
            --green-hs: #2ecc71;
            --amber-hs: #f39c12;
        }

        *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Rajdhani', sans-serif;
            background: var(--deep);
            color: var(--text);
            overflow-x: hidden;
            cursor: none;
        }

        /* ‚îÄ‚îÄ‚îÄ CURSOR ‚îÄ‚îÄ‚îÄ */
        #cur { position: fixed; width: 7px; height: 7px; background: var(--gold); border-radius: 50%; pointer-events: none; z-index: 9999; transition: transform 0.1s; mix-blend-mode: difference; }
        #curR { position: fixed; width: 28px; height: 28px; border: 1px solid rgba(201,168,76,0.55); border-radius: 50%; pointer-events: none; z-index: 9998; transition: all 0.14s ease; }

        /* ‚îÄ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ‚îÄ */
        .header {
            position: relative;
            padding: 28px 60px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: linear-gradient(to bottom, var(--deep) 60%, transparent);
            z-index: 50;
        }
        .header-logo {
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.5rem;
            font-weight: 600;
            letter-spacing: 4px;
            color: var(--gold);
            text-transform: uppercase;
        }
        .header-logo span { color: var(--text-dim); font-weight: 300; }

        .header-title {
            text-align: center;
        }
        .header-title h1 {
            font-family: 'Cormorant Garamond', serif;
            font-size: 2rem;
            font-weight: 300;
            letter-spacing: 6px;
            text-transform: uppercase;
            color: var(--text);
        }
        .header-title h1 em { font-style: italic; color: var(--gold); }
        .header-title p {
            font-family: 'Space Mono', monospace;
            font-size: 0.6rem;
            letter-spacing: 4px;
            color: var(--text-dim);
            text-transform: uppercase;
            margin-top: 4px;
        }

        .header-badge {
            font-family: 'Space Mono', monospace;
            font-size: 0.6rem;
            letter-spacing: 3px;
            color: var(--text-dim);
            border: 1px solid var(--glass-border);
            padding: 8px 14px;
            text-transform: uppercase;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .badge-dot { width: 6px; height: 6px; background: #2ecc71; border-radius: 50%; animation: blink 1.5s infinite; }
        @keyframes blink { 0%,100% { opacity: 1; } 50% { opacity: 0.3; } }

        /* ‚îÄ‚îÄ‚îÄ MENU ‚îÄ‚îÄ‚îÄ */
        #menu {
            background: rgba(4,7,14,0.95);
            backdrop-filter: blur(20px);
            border-top: 1px solid var(--glass-border);
            border-bottom: 1px solid var(--glass-border);
            padding: 0 40px;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-items: stretch;
            position: sticky;
            top: 0;
            z-index: 100;
            gap: 0;
        }

        #menu button {
            padding: 18px 24px;
            background: transparent;
            border: none;
            border-right: 1px solid var(--glass-border);
            color: var(--text-dim);
            cursor: none;
            font-family: 'Rajdhani', sans-serif;
            font-size: 0.9rem;
            font-weight: 500;
            letter-spacing: 1.5px;
            text-transform: uppercase;
            transition: all 0.3s ease;
            position: relative;
            white-space: nowrap;
            display: flex;
            align-items: center;
            gap: 7px;
        }
        #menu button::after {
            content: '';
            position: absolute;
            bottom: 0; left: 0; right: 0;
            height: 2px;
            background: var(--gold);
            transform: scaleX(0);
            transition: transform 0.3s;
        }
        #menu button:hover { color: var(--text); background: var(--glass); }
        #menu button:hover::after { transform: scaleX(1); }
        #menu button.active { color: var(--gold); }
        #menu button.active::after { transform: scaleX(1); }

        .menu-icon { font-size: 1rem; }

        /* ‚îÄ‚îÄ‚îÄ VIEWER LAYOUT ‚îÄ‚îÄ‚îÄ */
        .viewer-wrap {
            position: relative;
            width: 100%;
            height: 78vh;
        }

        #viewer { width: 100%; height: 100%; }

        /* ‚îÄ‚îÄ‚îÄ HUD OVERLAYS ‚îÄ‚îÄ‚îÄ */
        .hud {
            position: absolute;
            top: 20px; left: 20px;
            z-index: 20;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .hud-box {
            background: rgba(4,7,14,0.85);
            backdrop-filter: blur(16px);
            border: 1px solid var(--glass-border);
            padding: 10px 18px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .hud-label {
            font-family: 'Space Mono', monospace;
            font-size: 0.6rem;
            letter-spacing: 3px;
            color: var(--text-dim);
            text-transform: uppercase;
        }
        .hud-value {
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--gold);
        }

        /* Scene / View counter */
        .hud-top-right {
            position: absolute;
            top: 20px; right: 20px;
            z-index: 20;
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 10px;
        }

        /* View nav arrows */
        .vnav {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            z-index: 20;
        }
        .vnav.l { left: 24px; }
        .vnav.r { right: 24px; }

        .vnav-btn {
            width: 56px; height: 56px;
            background: rgba(4,7,14,0.85);
            backdrop-filter: blur(16px);
            border: 1px solid var(--glass-border);
            color: var(--text-dim);
            cursor: none;
            font-size: 1.1rem;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .vnav-btn:hover { background: var(--gold); color: var(--deep); border-color: var(--gold); }
        .vnav-btn:disabled { opacity: 0.2; pointer-events: none; }

        /* Bottom controls */
        .controls {
            position: absolute;
            bottom: 28px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 8px;
            z-index: 20;
        }
        .ctrl-btn {
            width: 48px; height: 48px;
            background: rgba(4,7,14,0.85);
            backdrop-filter: blur(16px);
            border: 1px solid var(--glass-border);
            color: var(--text-dim);
            cursor: none;
            font-size: 1rem;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .ctrl-btn:hover { border-color: var(--gold); color: var(--gold); }
        .ctrl-btn.active { border-color: var(--gold); color: var(--gold); background: var(--gold-glow); }

        /* Loading */
        .loading {
            position: absolute;
            inset: 0;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: rgba(4,7,14,0.92);
            backdrop-filter: blur(20px);
            z-index: 30;
            gap: 20px;
        }
        .loading.show { display: flex; }
        .load-ring {
            width: 60px; height: 60px;
            border: 1px solid var(--glass-border);
            border-top-color: var(--gold);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        .load-text {
            font-family: 'Space Mono', monospace;
            font-size: 0.65rem;
            letter-spacing: 4px;
            color: var(--text-dim);
            text-transform: uppercase;
        }

        /* Compass ring deco */
        .compass-deco {
            position: absolute;
            bottom: 90px;
            right: 28px;
            width: 70px; height: 70px;
            border: 1px solid rgba(201,168,76,0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 20;
            animation: rotateCompass 30s linear infinite;
        }
        .compass-deco::before {
            content: 'N';
            position: absolute;
            top: 6px;
            font-family: 'Space Mono', monospace;
            font-size: 0.55rem;
            color: var(--gold);
            letter-spacing: 1px;
        }
        .compass-deco i { color: rgba(201,168,76,0.4); font-size: 1.2rem; }
        @keyframes rotateCompass { from { transform: rotate(0); } to { transform: rotate(360deg); } }

        /* ‚îÄ‚îÄ‚îÄ INFO PANEL ‚îÄ‚îÄ‚îÄ */
        .info-panel {
            background: var(--dark1);
            border-top: 1px solid var(--glass-border);
            display: grid;
            grid-template-columns: 1fr auto;
            align-items: center;
            padding: 0 60px;
            gap: 40px;
            min-height: 120px;
        }

        .info-left {
            display: flex;
            flex-direction: column;
            gap: 8px;
            padding: 28px 0;
        }
        .info-tag {
            font-family: 'Space Mono', monospace;
            font-size: 0.6rem;
            letter-spacing: 4px;
            color: var(--gold);
            text-transform: uppercase;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .info-tag::before { content: ''; width: 20px; height: 1px; background: var(--gold); }

        #title {
            font-family: 'Cormorant Garamond', serif;
            font-size: 2.2rem;
            font-weight: 600;
            color: var(--text);
            line-height: 1;
        }
        #desc {
            font-size: 0.95rem;
            color: var(--text-dim);
            font-weight: 300;
            line-height: 1.7;
            max-width: 600px;
        }

        .info-right {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .book-btn {
            padding: 16px 40px;
            background: transparent;
            border: 1px solid var(--gold);
            color: var(--gold);
            cursor: none;
            font-family: 'Rajdhani', sans-serif;
            font-weight: 600;
            font-size: 0.85rem;
            letter-spacing: 3px;
            text-transform: uppercase;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }
        .book-btn::before {
            content: '';
            position: absolute;
            inset: 0;
            background: var(--gold);
            transform: scaleX(0);
            transform-origin: left;
            transition: transform 0.3s;
            z-index: -1;
        }
        .book-btn:hover { color: var(--deep); }
        .book-btn:hover::before { transform: scaleX(1); }

        .share-btn {
            width: 50px; height: 50px;
            background: transparent;
            border: 1px solid var(--glass-border);
            color: var(--text-dim);
            cursor: none;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            transition: all 0.3s;
        }
        .share-btn:hover { border-color: var(--gold); color: var(--gold); }

        /* ‚îÄ‚îÄ‚îÄ PANNELLUM OVERRIDES ‚îÄ‚îÄ‚îÄ */
        .pnlm-container { background: var(--deep) !important; }
        .pnlm-ui { font-family: 'Rajdhani', sans-serif !important; }

        /* Custom hotspot */
        .pnlm-hotspot-base.custom-hotspot {
            background: rgba(4,7,14,0.9) !important;
            backdrop-filter: blur(12px) !important;
            color: var(--text) !important;
            border: 1px solid var(--glass-border) !important;
            border-radius: 0 !important;
            padding: 8px 16px !important;
            font-family: 'Rajdhani', sans-serif !important;
            font-size: 0.85rem !important;
            font-weight: 600 !important;
            letter-spacing: 1.5px !important;
            transition: all 0.3s !important;
            white-space: nowrap !important;
        }
        .pnlm-hotspot-base.custom-hotspot:hover {
            background: var(--gold-glow) !important;
            border-color: var(--gold) !important;
            color: var(--gold) !important;
        }

        .pnlm-hotspot-base.view-hotspot {
            background: rgba(201,168,76,0.15) !important;
            backdrop-filter: blur(12px) !important;
            color: var(--gold) !important;
            border: 1px solid rgba(201,168,76,0.5) !important;
            border-radius: 0 !important;
            padding: 8px 16px !important;
            font-family: 'Space Mono', monospace !important;
            font-size: 0.65rem !important;
            font-weight: 700 !important;
            letter-spacing: 2px !important;
            white-space: nowrap !important;
        }
        .pnlm-hotspot-base.view-hotspot:hover {
            background: var(--gold-glow) !important;
            border-color: var(--gold) !important;
        }

        /* Scan line overlay on panorama */
        .viewer-wrap::after {
            content: '';
            position: absolute;
            inset: 0;
            background: repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(0,0,0,0.02) 2px, rgba(0,0,0,0.02) 4px);
            pointer-events: none;
            z-index: 5;
        }

        /* ‚îÄ‚îÄ‚îÄ RESPONSIVE ‚îÄ‚îÄ‚îÄ */
        @media (max-width: 900px) {
            .header { padding: 20px 24px; }
            .header-badge { display: none; }
            .info-panel { grid-template-columns: 1fr; padding: 24px; gap: 20px; }
            #menu { padding: 0 10px; }
            #menu button { padding: 14px 12px; font-size: 0.75rem; gap: 4px; }
            .viewer-wrap { height: 60vh; }
            .hud { display: none; }
        }
        .header-logo {
        text-decoration: none;
        color: inherit;
        font-weight: bold;
        }
    </style>
</head>
<body>

<div id="cur"></div>
<div id="curR"></div>

<!-- Header -->
<header class="header">
    <a th:href="@{/tour3d}" class="header-logo">
        An <span>Giang</span>
    </a>

    <div class="header-title">
        <h1>Virtual <em>Tour</em></h1>
        <p>360¬∞ Immersive Experience ¬∑ An Giang Province</p>
    </div>

    <div class="header-badge">
        <div class="badge-dot"></div>
        Live ¬∑ 9 ƒê·ªãa ƒêi·ªÉm
    </div>
</header>

<!-- Menu -->
<div id="menu">
    <button onclick="loadScene('angiang')" class="active" data-scene="angiang"><span class="menu-icon">üèûÔ∏è</span>An Giang</button>
    <button onclick="loadScene('chaudoc1')" data-scene="chaudoc1"><span class="menu-icon">üèØ</span>Ch√¢u ƒê·ªëc</button>
    <button onclick="loadScene('nuicam1')" data-scene="nuicam1"><span class="menu-icon">‚õ∞Ô∏è</span>N√∫i C·∫•m</button>
    <button onclick="loadScene('nuisam1')" data-scene="nuisam1"><span class="menu-icon">üôè</span>N√∫i Sam</button>
    <button onclick="loadScene('tapa1')" data-scene="tapa1"><span class="menu-icon">üíô</span>H·ªì T√† P·∫°</button>
    <button onclick="loadScene('rung1')" data-scene="rung1"><span class="menu-icon">üå≥</span>R·ª´ng Tr√†m</button>
    <button onclick="loadScene('chuatapa1')" data-scene="chuatapa1"><span class="menu-icon">üõï</span>Ch√πa T√† P·∫°</button>
    <button onclick="loadScene('tayan1')" data-scene="tayan1"><span class="menu-icon">üèõÔ∏è</span>T√¢y An</button>
    <button onclick="loadScene('lang1')" data-scene="lang1"><span class="menu-icon">üëë</span>LƒÉng TNH</button>
</div>

<!-- Viewer -->
<div class="viewer-wrap">
    <div id="viewer"></div>

    <!-- HUD Top Left -->
    <div class="hud">
        <div class="hud-box">
            <div>
                <div class="hud-label">ƒê·ªãa ƒëi·ªÉm</div>
                <div class="hud-value" id="hudLocation">An Giang</div>
            </div>
        </div>
        <div class="hud-box">
            <div>
                <div class="hud-label">C·∫£nh</div>
                <div class="hud-value" id="sceneCounter">1 / 9</div>
            </div>
        </div>
    </div>

    <!-- HUD Top Right -->
    <div class="hud-top-right">
        <div class="hud-box" id="viewCounter" style="display:none;">
            <div>
                <div class="hud-label">G√≥c nh√¨n</div>
                <div class="hud-value" id="viewCounterVal">1 / 3</div>
            </div>
        </div>
    </div>

    <!-- View nav arrows -->
    <div class="vnav l" id="viewNavLeft" style="display:none;">
        <button class="vnav-btn" onclick="previousView()"><i class="bi bi-chevron-left"></i></button>
    </div>
    <div class="vnav r" id="viewNavRight" style="display:none;">
        <button class="vnav-btn" onclick="nextView()"><i class="bi bi-chevron-right"></i></button>
    </div>

    <!-- Loading -->
    <div class="loading" id="loading">
        <div class="load-ring"></div>
        <div class="load-text">ƒêang t·∫£i c·∫£nh</div>
    </div>

    <!-- Controls -->
    <div class="controls">
        <button class="ctrl-btn active" id="audioBtn" onclick="toggleAudio()" title="√Çm thanh">
            <i class="bi bi-volume-up-fill"></i>
        </button>
        <button class="ctrl-btn" id="rotateBtn" onclick="toggleAutoRotate()" title="T·ª± ƒë·ªông xoay">
            <i class="bi bi-arrow-repeat"></i>
        </button>
        <button class="ctrl-btn" onclick="toggleFullscreen()" title="To√†n m√†n h√¨nh">
            <i class="bi bi-fullscreen"></i>
        </button>
    </div>

    <!-- Compass deco -->
    <div class="compass-deco">
        <i class="bi bi-compass"></i>
    </div>
</div>

<!-- Info Panel -->
<div class="info-panel">
    <div class="info-left">
        <div class="info-tag" id="infoTag">Virtual Reality ¬∑ 360¬∞</div>
        <h2 id="title">An Giang</h2>
        <p id="desc">To√†n c·∫£nh An Giang - V√πng ƒë·∫•t gi√†u b·∫£n s·∫Øc vƒÉn h√≥a mi·ªÅn T√¢y</p>
    </div>
    <div class="info-right">
        <button class="share-btn" title="Chia s·∫ª"><i class="bi bi-share"></i></button>
        <button class="share-btn" title="Y√™u th√≠ch"><i class="bi bi-heart"></i></button>
        <button class="book-btn" onclick="bookTour()">
            ƒê·∫∑t tour ngay <i class="bi bi-arrow-right"></i>
        </button>
    </div>
</div>

<script>
    // ‚îÄ‚îÄ‚îÄ Custom Cursor ‚îÄ‚îÄ‚îÄ
    const cur = document.getElementById('cur');
    const curR = document.getElementById('curR');
    let mx = 0, my = 0, rx = 0, ry = 0;
    document.addEventListener('mousemove', e => {
        mx = e.clientX; my = e.clientY;
        cur.style.left = (mx - 3.5) + 'px';
        cur.style.top = (my - 3.5) + 'px';
    });
    (function loop() {
        rx += (mx - rx) * 0.12; ry += (my - ry) * 0.12;
        curR.style.left = (rx - 14) + 'px';
        curR.style.top = (ry - 14) + 'px';
        requestAnimationFrame(loop);
    })();
    document.querySelectorAll('button, a').forEach(el => {
        el.addEventListener('mouseenter', () => { cur.style.transform = 'scale(3)'; curR.style.transform = 'scale(1.4)'; curR.style.borderColor = 'rgba(201,168,76,1)'; });
        el.addEventListener('mouseleave', () => { cur.style.transform = 'scale(1)'; curR.style.transform = 'scale(1)'; curR.style.borderColor = 'rgba(201,168,76,0.55)'; });
    });

    // ‚îÄ‚îÄ‚îÄ Data ‚îÄ‚îÄ‚îÄ
    const descriptions = {
        "angiang": "To√†n c·∫£nh An Giang - V√πng ƒë·∫•t gi√†u b·∫£n s·∫Øc vƒÉn h√≥a mi·ªÅn T√¢y",
        "chaudoc1": "Mi·∫øu B√† Ch√¢u ƒê·ªëc - N∆°i linh thi√™ng b·∫≠c nh·∫•t mi·ªÅn T√¢y",
        "nuicam1": "N√∫i C·∫•m - N√≥c nh√† mi·ªÅn T√¢y v·ªõi ƒë·ªô cao 710m",
        "nuisam1": "N√∫i Sam - Trung t√¢m t√¢m linh n·ªïi ti·∫øng v√πng ƒë·ªìng b·∫±ng",
        "tapa1": "H·ªì T√† P·∫° - Tuy·ªát t√¨nh c·ªëc ƒë·∫πp nh∆∞ tranh v·∫Ω",
        "rung1": "R·ª´ng Tr√†m Tr√† S∆∞ - R·ª´ng ng·∫≠p m·∫∑n xanh m√°t quanh nƒÉm",
        "chuatapa1": "Ch√πa T√† P·∫° - Ng√¥i ch√πa linh thi√™ng tr√™n ƒë·ªìi cao",
        "tayan1": "T√¢y An C·ªï T·ª± - Ki·∫øn tr√∫c Khmer ƒë·ªôc ƒë√°o v√† tinh x·∫£o",
        "lang1": "LƒÉng Tho·∫°i Ng·ªçc H·∫ßu - Di t√≠ch l·ªãch s·ª≠ vƒÉn h√≥a qu·ªëc gia"
    };
    const infoTags = {
        "angiang": "T·ªïng quan ¬∑ Panorama 360¬∞",
        "chaudoc1": "T√¢m Linh ¬∑ Ch√¢u ƒê·ªëc",
        "nuicam1": "Thi√™n Nhi√™n ¬∑ Th·∫•t S∆°n ¬∑ 710m",
        "nuisam1": "T√¢m Linh ¬∑ N√∫i Sam",
        "tapa1": "Thi√™n Nhi√™n ¬∑ Tuy·ªát T√¨nh C·ªëc",
        "rung1": "Sinh Th√°i ¬∑ R·ª´ng Tr√†m Tr√† S∆∞",
        "chuatapa1": "T√¢m Linh ¬∑ Ph·∫≠t Gi√°o Khmer",
        "tayan1": "Di S·∫£n ¬∑ Ki·∫øn Tr√∫c Khmer",
        "lang1": "L·ªãch S·ª≠ ¬∑ Di T√≠ch Qu·ªëc Gia"
    };
    const tourIds = {
        "angiang": 1, "chaudoc1": 1, "nuicam1": 31, "nuisam1": 32,
        "tapa1": 4, "rung1": 3, "chuatapa1": 33, "tayan1": 7, "lang1": 34
    };
    const sceneNames = ["angiang","chaudoc1","nuicam1","nuisam1","tapa1","rung1","chuatapa1","tayan1","lang1"];
    const locationViews = {
        "chaudoc": ["chaudoc1","chaudoc2"],
        "nuicam": ["nuicam1","nuicam2","nuicam3"],
        "nuisam": ["nuisam1","nuisam2","nuisam3"],
        "tapa": ["tapa1","tapa2","tapa3"],
        "rung": ["rung1","rung2","rung3"],
        "chuatapa": ["chuatapa1","chuatapa2","chuatapa3"],
        "tayan": ["tayan1","tayan2","tayan3"],
        "lang": ["lang1","lang2"]
    };
    const locationAudios = {
        "angiang": "/audio/angiang.mp3",
        "chaudoc1": "/audio/chaudoc.mp3",
        "nuicam1": "/audio/nuicam.mp3",
        "nuisam1": "/audio/nuisam.mp3",
        "tapa1": "/audio/hotapa.mp3",
        "rung1": "/audio/rung.mp3",
        "chuatapa1": "/audio/chuatapa.mp3",
        "tayan1": "/audio/tayan.mp3",
        "lang1": "/audio/thoaingochau.mp3"
    };
    const sceneDisplayNames = {
        "angiang": "An Giang", "chaudoc1": "Ch√¢u ƒê·ªëc", "nuicam1": "N√∫i C·∫•m",
        "nuisam1": "N√∫i Sam", "tapa1": "H·ªì T√† P·∫°", "rung1": "R·ª´ng Tr√†m Tr√† S∆∞",
        "chuatapa1": "Ch√πa T√† P·∫°", "tayan1": "T√¢y An C·ªï T·ª±", "lang1": "LƒÉng Tho·∫°i Ng·ªçc H·∫ßu"
    };

    let autoRotateEnabled = true;
    let currentLocation = "angiang";
    let currentViewIndex = 0;
    let currentAudio = null;

    // ‚îÄ‚îÄ‚îÄ Pannellum ‚îÄ‚îÄ‚îÄ
    const viewer = pannellum.viewer('viewer', {
        "default": {
            "firstScene": "angiang",
            "autoLoad": true,
            "autoRotate": -2,
            "autoRotateInactivityDelay": 2000,
            "compass": false,
            "showZoomCtrl": false,
            "mouseZoom": true,
            "draggable": true,
            "friction": 0.15,
            "hfov": 100,
        },
        "scenes": {
            "angiang": {
                "panorama": "/image/test.JPG", "autoRotate": -2,
                "hotSpots": [
                    {"pitch":-5,"yaw":45,"type":"scene","sceneId":"chaudoc1","text":"üèØ Ch√¢u ƒê·ªëc","cssClass":"custom-hotspot"},
                    {"pitch":0,"yaw":90,"type":"scene","sceneId":"nuicam1","text":"‚õ∞Ô∏è N√∫i C·∫•m","cssClass":"custom-hotspot"},
                    {"pitch":-5,"yaw":135,"type":"scene","sceneId":"nuisam1","text":"üôè N√∫i Sam","cssClass":"custom-hotspot"},
                    {"pitch":0,"yaw":180,"type":"scene","sceneId":"tapa1","text":"üíô H·ªì T√† P·∫°","cssClass":"custom-hotspot"},
                    {"pitch":-5,"yaw":-135,"type":"scene","sceneId":"rung1","text":"üå≥ R·ª´ng Tr√†m","cssClass":"custom-hotspot"},
                    {"pitch":0,"yaw":-90,"type":"scene","sceneId":"chuatapa1","text":"üõï Ch√πa T√† P·∫°","cssClass":"custom-hotspot"},
                    {"pitch":-5,"yaw":-45,"type":"scene","sceneId":"tayan1","text":"üèõÔ∏è T√¢y An","cssClass":"custom-hotspot"},
                    {"pitch":0,"yaw":0,"type":"scene","sceneId":"lang1","text":"üëë LƒÉng TNH","cssClass":"custom-hotspot"}
                ]
            },
            "chaudoc1": {"panorama":"/image/thoaingochau2.jpg","autoRotate":-2,"hotSpots":[
                {"pitch":5,"yaw":100,"type":"scene","sceneId":"chaudoc2","text":"‚Üí G√≥c xem kh√°c","cssClass":"view-hotspot"},
                {"pitch":-8,"yaw":-45,"type":"scene","sceneId":"nuicam1","text":"‚õ∞Ô∏è N√∫i C·∫•m","cssClass":"custom-hotspot"},
                {"pitch":-8,"yaw":180,"type":"scene","sceneId":"angiang","text":"üèûÔ∏è T·ªïng quan","cssClass":"custom-hotspot"}
            ]},
            "chaudoc2": {"panorama":"/image/test3.jpg","autoRotate":-2,"hotSpots":[
                {"pitch":5,"yaw":-100,"type":"scene","sceneId":"chaudoc1","text":"‚Üê G√≥c xem tr∆∞·ªõc","cssClass":"view-hotspot"},
                {"pitch":-8,"yaw":45,"type":"scene","sceneId":"nuicam1","text":"‚õ∞Ô∏è N√∫i C·∫•m","cssClass":"custom-hotspot"}
            ]},
            "nuicam1": {"panorama":"/image/dlnuicam1.jpg","autoRotate":-2,"hotSpots":[
                {"pitch":5,"yaw":100,"type":"scene","sceneId":"nuicam2","text":"‚Üí G√≥c xem kh√°c","cssClass":"view-hotspot"},
                {"pitch":-8,"yaw":-90,"type":"scene","sceneId":"chaudoc1","text":"üèØ Ch√¢u ƒê·ªëc","cssClass":"custom-hotspot"},
                {"pitch":-8,"yaw":45,"type":"scene","sceneId":"nuisam1","text":"üôè N√∫i Sam","cssClass":"custom-hotspot"}
            ]},
            "nuicam2": {"panorama":"/image/dlnuicam2.jpg","autoRotate":-2,"hotSpots":[
                {"pitch":5,"yaw":-100,"type":"scene","sceneId":"nuicam1","text":"‚Üê G√≥c xem tr∆∞·ªõc","cssClass":"view-hotspot"},
                {"pitch":5,"yaw":100,"type":"scene","sceneId":"nuicam3","text":"‚Üí G√≥c xem kh√°c","cssClass":"view-hotspot"},
                {"pitch":-8,"yaw":0,"type":"scene","sceneId":"nuisam1","text":"üôè N√∫i Sam","cssClass":"custom-hotspot"}
            ]},
            "nuicam3": {"panorama":"/image/dlnuicam3.jpg","autoRotate":-2,"hotSpots":[
                {"pitch":5,"yaw":-100,"type":"scene","sceneId":"nuicam2","text":"‚Üê G√≥c xem tr∆∞·ªõc","cssClass":"view-hotspot"},
                {"pitch":-8,"yaw":90,"type":"scene","sceneId":"nuisam1","text":"üôè N√∫i Sam","cssClass":"custom-hotspot"}
            ]},
            "nuisam1": {"panorama":"/image/dlnuisam1.jpg","autoRotate":-2,"hotSpots":[
                {"pitch":5,"yaw":100,"type":"scene","sceneId":"nuisam2","text":"‚Üí G√≥c xem kh√°c","cssClass":"view-hotspot"},
                {"pitch":-8,"yaw":-90,"type":"scene","sceneId":"nuicam1","text":"‚õ∞Ô∏è N√∫i C·∫•m","cssClass":"custom-hotspot"},
                {"pitch":-8,"yaw":45,"type":"scene","sceneId":"tapa1","text":"üíô H·ªì T√† P·∫°","cssClass":"custom-hotspot"}
            ]},
            "nuisam2": {"panorama":"/image/dlnuisam2.jpg","autoRotate":-2,"hotSpots":[
                {"pitch":5,"yaw":-100,"type":"scene","sceneId":"nuisam1","text":"‚Üê G√≥c xem tr∆∞·ªõc","cssClass":"view-hotspot"},
                {"pitch":5,"yaw":100,"type":"scene","sceneId":"nuisam3","text":"‚Üí G√≥c xem kh√°c","cssClass":"view-hotspot"},
                {"pitch":-8,"yaw":0,"type":"scene","sceneId":"tapa1","text":"üíô H·ªì T√† P·∫°","cssClass":"custom-hotspot"}
            ]},
            "nuisam3": {"panorama":"/image/dlnuisam3.jpg","autoRotate":-2,"hotSpots":[
                {"pitch":5,"yaw":-100,"type":"scene","sceneId":"nuisam2","text":"‚Üê G√≥c xem tr∆∞·ªõc","cssClass":"view-hotspot"},
                {"pitch":-8,"yaw":90,"type":"scene","sceneId":"tapa1","text":"üíô H·ªì T√† P·∫°","cssClass":"custom-hotspot"}
            ]},
            "tapa1": {"panorama":"/image/tapa3.jpg","autoRotate":-2,"hotSpots":[
                {"pitch":5,"yaw":100,"type":"scene","sceneId":"tapa2","text":"‚Üí G√≥c xem kh√°c","cssClass":"view-hotspot"},
                {"pitch":-8,"yaw":-90,"type":"scene","sceneId":"nuisam1","text":"üôè N√∫i Sam","cssClass":"custom-hotspot"},
                {"pitch":-8,"yaw":45,"type":"scene","sceneId":"rung1","text":"üå≥ R·ª´ng Tr√†m","cssClass":"custom-hotspot"}
            ]},
            "tapa2": {"panorama":"/image/tapa2.jpg","autoRotate":-2,"hotSpots":[
                {"pitch":5,"yaw":-100,"type":"scene","sceneId":"tapa1","text":"‚Üê G√≥c xem tr∆∞·ªõc","cssClass":"view-hotspot"},
                {"pitch":5,"yaw":100,"type":"scene","sceneId":"tapa3","text":"‚Üí G√≥c xem kh√°c","cssClass":"view-hotspot"},
                {"pitch":-8,"yaw":0,"type":"scene","sceneId":"rung1","text":"üå≥ R·ª´ng Tr√†m","cssClass":"custom-hotspot"}
            ]},
            "tapa3": {"panorama":"/image/tapa1.jpg","autoRotate":-2,"hotSpots":[
                {"pitch":5,"yaw":-100,"type":"scene","sceneId":"tapa2","text":"‚Üê G√≥c xem tr∆∞·ªõc","cssClass":"view-hotspot"},
                {"pitch":-8,"yaw":90,"type":"scene","sceneId":"rung1","text":"üå≥ R·ª´ng Tr√†m","cssClass":"custom-hotspot"}
            ]},
            "rung1": {"panorama":"/image/rungtram1.jpg","autoRotate":-2,"hotSpots":[
                {"pitch":5,"yaw":100,"type":"scene","sceneId":"rung2","text":"‚Üí G√≥c xem kh√°c","cssClass":"view-hotspot"},
                {"pitch":-8,"yaw":-90,"type":"scene","sceneId":"tapa1","text":"üíô H·ªì T√† P·∫°","cssClass":"custom-hotspot"},
                {"pitch":-8,"yaw":45,"type":"scene","sceneId":"chuatapa1","text":"üõï Ch√πa T√† P·∫°","cssClass":"custom-hotspot"}
            ]},
            "rung2": {"panorama":"/image/rungtram2.jpg","autoRotate":-2,"hotSpots":[
                {"pitch":5,"yaw":-100,"type":"scene","sceneId":"rung1","text":"‚Üê G√≥c xem tr∆∞·ªõc","cssClass":"view-hotspot"},
                {"pitch":5,"yaw":100,"type":"scene","sceneId":"rung3","text":"‚Üí G√≥c xem kh√°c","cssClass":"view-hotspot"},
                {"pitch":-8,"yaw":0,"type":"scene","sceneId":"chuatapa1","text":"üõï Ch√πa T√† P·∫°","cssClass":"custom-hotspot"}
            ]},
            "rung3": {"panorama":"/image/rungtram3.jpg","autoRotate":-2,"hotSpots":[
                {"pitch":5,"yaw":-100,"type":"scene","sceneId":"rung2","text":"‚Üê G√≥c xem tr∆∞·ªõc","cssClass":"view-hotspot"},
                {"pitch":-8,"yaw":90,"type":"scene","sceneId":"chuatapa1","text":"üõï Ch√πa T√† P·∫°","cssClass":"custom-hotspot"}
            ]},
            "chuatapa1": {"panorama":"/image/tapa1.jpg","autoRotate":-2,"hotSpots":[
                {"pitch":5,"yaw":100,"type":"scene","sceneId":"chuatapa2","text":"‚Üí G√≥c xem kh√°c","cssClass":"view-hotspot"},
                {"pitch":-8,"yaw":-90,"type":"scene","sceneId":"rung1","text":"üå≥ R·ª´ng Tr√†m","cssClass":"custom-hotspot"},
                {"pitch":-8,"yaw":45,"type":"scene","sceneId":"tayan1","text":"üèõÔ∏è T√¢y An","cssClass":"custom-hotspot"}
            ]},
            "chuatapa2": {"panorama":"/image/tapa2.jpg","autoRotate":-2,"hotSpots":[
                {"pitch":5,"yaw":-100,"type":"scene","sceneId":"chuatapa1","text":"‚Üê G√≥c xem tr∆∞·ªõc","cssClass":"view-hotspot"},
                {"pitch":5,"yaw":100,"type":"scene","sceneId":"chuatapa3","text":"‚Üí G√≥c xem kh√°c","cssClass":"view-hotspot"},
                {"pitch":-8,"yaw":0,"type":"scene","sceneId":"tayan1","text":"üèõÔ∏è T√¢y An","cssClass":"custom-hotspot"}
            ]},
            "chuatapa3": {"panorama":"/image/tapa3.jpg","autoRotate":-2,"hotSpots":[
                {"pitch":5,"yaw":-100,"type":"scene","sceneId":"chuatapa2","text":"‚Üê G√≥c xem tr∆∞·ªõc","cssClass":"view-hotspot"},
                {"pitch":-8,"yaw":90,"type":"scene","sceneId":"tayan1","text":"üèõÔ∏è T√¢y An","cssClass":"custom-hotspot"}
            ]},
            "tayan1": {"panorama":"/image/tayan1.jpg","autoRotate":-2,"hotSpots":[
                {"pitch":5,"yaw":100,"type":"scene","sceneId":"tayan2","text":"‚Üí G√≥c xem kh√°c","cssClass":"view-hotspot"},
                {"pitch":-8,"yaw":-90,"type":"scene","sceneId":"chuatapa1","text":"üõï Ch√πa T√† P·∫°","cssClass":"custom-hotspot"},
                {"pitch":-8,"yaw":45,"type":"scene","sceneId":"lang1","text":"üëë LƒÉng TNH","cssClass":"custom-hotspot"}
            ]},
            "tayan2": {"panorama":"/image/tayan2.jpg","autoRotate":-2,"hotSpots":[
                {"pitch":5,"yaw":-100,"type":"scene","sceneId":"tayan1","text":"‚Üê G√≥c xem tr∆∞·ªõc","cssClass":"view-hotspot"},
                {"pitch":5,"yaw":100,"type":"scene","sceneId":"tayan3","text":"‚Üí G√≥c xem kh√°c","cssClass":"view-hotspot"},
                {"pitch":-8,"yaw":0,"type":"scene","sceneId":"lang1","text":"üëë LƒÉng TNH","cssClass":"custom-hotspot"}
            ]},
            "tayan3": {"panorama":"/image/tayan3.jpg","autoRotate":-2,"hotSpots":[
                {"pitch":5,"yaw":-100,"type":"scene","sceneId":"tayan2","text":"‚Üê G√≥c xem tr∆∞·ªõc","cssClass":"view-hotspot"},
                {"pitch":-8,"yaw":90,"type":"scene","sceneId":"lang1","text":"üëë LƒÉng TNH","cssClass":"custom-hotspot"}
            ]},
            "lang1": {"panorama":"/image/thoaingochau2.jpg","autoRotate":-2,"hotSpots":[
                {"pitch":5,"yaw":100,"type":"scene","sceneId":"lang2","text":"‚Üí G√≥c xem kh√°c","cssClass":"view-hotspot"},
                {"pitch":-8,"yaw":-90,"type":"scene","sceneId":"tayan1","text":"üèõÔ∏è T√¢y An","cssClass":"custom-hotspot"},
                {"pitch":-8,"yaw":180,"type":"scene","sceneId":"angiang","text":"üèûÔ∏è T·ªïng quan","cssClass":"custom-hotspot"}
            ]},
            "lang2": {"panorama":"/image/thoaingochau1.jpg","autoRotate":-2,"hotSpots":[
                {"pitch":5,"yaw":-100,"type":"scene","sceneId":"lang1","text":"‚Üê G√≥c xem tr∆∞·ªõc","cssClass":"view-hotspot"},
                {"pitch":-8,"yaw":45,"type":"scene","sceneId":"angiang","text":"üèûÔ∏è T·ªïng quan","cssClass":"custom-hotspot"}
            ]}
        }
    });

    // ‚îÄ‚îÄ‚îÄ Functions ‚îÄ‚îÄ‚îÄ
    function loadScene(id) {
        document.getElementById('loading').classList.add('show');
        let base = getBase(id);

        document.querySelectorAll('#menu button').forEach(btn => {
            btn.classList.toggle('active', btn.dataset.scene === base);
        });

        viewer.loadScene(id);
        currentLocation = base;
        updateViewNav(id);
        playAudio(base);
        updateInfo(base);
        updateCounter(base);

        setTimeout(() => document.getElementById('loading').classList.remove('show'), 600);
    }

    function playAudio(loc) {
        if (currentAudio) { currentAudio.pause(); currentAudio.currentTime = 0; }
        const f = locationAudios[loc];
        if (f) {
            currentAudio = new Audio(f);
            currentAudio.loop = true;
            currentAudio.volume = 0.5;
            currentAudio.play().catch(() => {});
        }
        document.querySelector('#audioBtn i').className = 'bi bi-volume-up-fill';
    }

    function toggleAudio() {
        const icon = document.querySelector('#audioBtn i');
        const btn = document.getElementById('audioBtn');
        if (currentAudio) {
            if (currentAudio.paused) {
                currentAudio.play();
                icon.className = 'bi bi-volume-up-fill';
                btn.classList.add('active');
            } else {
                currentAudio.pause();
                icon.className = 'bi bi-volume-mute-fill';
                btn.classList.remove('active');
            }
        }
    }

    function getBase(id) {
        for (let loc in locationViews) {
            if (locationViews[loc].includes(id)) return locationViews[loc][0];
        }
        return id;
    }

    function getLoc(id) {
        for (let loc in locationViews) {
            if (locationViews[loc].includes(id)) return loc;
        }
        return null;
    }

    function updateViewNav(id) {
        const loc = getLoc(id);
        const vc = document.getElementById('viewCounter');
        const vcVal = document.getElementById('viewCounterVal');
        const nl = document.getElementById('viewNavLeft');
        const nr = document.getElementById('viewNavRight');

        if (loc && locationViews[loc]) {
            const views = locationViews[loc];
            currentViewIndex = views.indexOf(id);
            if (views.length > 1) {
                vc.style.display = 'flex';
                vcVal.textContent = `${currentViewIndex + 1} / ${views.length}`;
                nl.style.display = 'flex'; nr.style.display = 'flex';
                nl.querySelector('button').disabled = currentViewIndex === 0;
                nr.querySelector('button').disabled = currentViewIndex === views.length - 1;
            } else {
                vc.style.display = 'none'; nl.style.display = 'none'; nr.style.display = 'none';
            }
        } else {
            vc.style.display = 'none'; nl.style.display = 'none'; nr.style.display = 'none';
        }
    }

    function updateInfo(base) {
        document.getElementById('title').textContent = sceneDisplayNames[base] || base;
        document.getElementById('desc').textContent = descriptions[base] || '';
        document.getElementById('infoTag').textContent = infoTags[base] || 'Virtual Reality ¬∑ 360¬∞';
        document.getElementById('hudLocation').textContent = sceneDisplayNames[base] || base;
        window.currentScene = base;
    }

    function updateCounter(base) {
        const i = sceneNames.indexOf(base);
        if (i !== -1) document.getElementById('sceneCounter').textContent = `${i + 1} / ${sceneNames.length}`;
    }

    function previousView() {
        const loc = getLoc(viewer.getScene());
        if (loc && currentViewIndex > 0) loadScene(locationViews[loc][currentViewIndex - 1]);
    }

    function nextView() {
        const loc = getLoc(viewer.getScene());
        if (loc && currentViewIndex < locationViews[loc].length - 1) loadScene(locationViews[loc][currentViewIndex + 1]);
    }

    function toggleAutoRotate() {
        autoRotateEnabled = !autoRotateEnabled;
        viewer.setAutoRotate(autoRotateEnabled ? -2 : false);
        document.getElementById('rotateBtn').classList.toggle('active', autoRotateEnabled);
    }

    function toggleFullscreen() {
        const el = document.querySelector('.viewer-wrap');
        if (!document.fullscreenElement) el.requestFullscreen().catch(() => {});
        else document.exitFullscreen();
    }

    function bookTour() {
        window.location.href = "/tour/" + (tourIds[window.currentScene] || 1);
    }

    // ‚îÄ‚îÄ‚îÄ Init ‚îÄ‚îÄ‚îÄ
    window.currentScene = "angiang";
    updateCounter("angiang");
    updateViewNav("angiang");

    // Keyboard
    document.addEventListener('keydown', e => {
        if (e.key === 'ArrowLeft') previousView();
        else if (e.key === 'ArrowRight') nextView();
    });

    // Scene change listener
    viewer.on('scenechange', id => {
        const base = getBase(id);
        updateViewNav(id);
        document.querySelectorAll('#menu button').forEach(btn => btn.classList.toggle('active', btn.dataset.scene === base));
        updateInfo(base);
        updateCounter(base);
        if (currentLocation !== base) { currentLocation = base; playAudio(base); }
    });
</script>
</body>
</html>